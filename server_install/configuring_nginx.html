
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Configuring Nginx &mdash; FoOlFuuka 0.8.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.8.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="FoOlFuuka 0.8.0 documentation" href="../index.html" />
    <link rel="next" title="Installing Java Virtual Machine" href="installing_java.html" />
    <link rel="prev" title="Installing Nginx" href="installing_nginx.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="installing_java.html" title="Installing Java Virtual Machine"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="installing_nginx.html" title="Installing Nginx"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">FoOlFuuka 0.8.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="configuring-nginx">
<h1>Configuring Nginx<a class="headerlink" href="#configuring-nginx" title="Permalink to this headline">¶</a></h1>
<p>Since we’re at it, let’s go through a complete configuration for Nginx.</p>
<p>If you have installed Nginx from the official Nginx repositories as
suggested, you will have all the configurations in <tt class="docutils literal"><span class="pre">/etc/nginx</span></tt>.</p>
<div class="section" id="nginx-conf">
<h2>nginx.conf<a class="headerlink" href="#nginx-conf" title="Permalink to this headline">¶</a></h2>
<p>This is the file that gets loaded when Nginx starts. All other
configuration files are loaded from this file via includes.</p>
<div class="highlight-python"><pre>user  www-data; # or whatever www user you have
worker_processes  1; # 4 is good for big installations
worker_rlimit_nofile 30000; # avoid triggering the file limit

error_log  /var/log/nginx/error.log warn;
pid        /var/run/nginx.pid;

events {
    worker_connections  1024; # Tune it along with worker_process, but you won't hit this anyway
}

http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    # disabling access_log to reduce disk I/O
    access_log  off;

    # reduces disk I/O by a lot
    open_file_cache max=1000 inactive=300s;
    open_file_cache_valid    360s;
    open_file_cache_min_uses 2;
    open_file_cache_errors   off;

    sendfile        on;
    #tcp_nopush     on;

    keepalive_timeout  65;

    # Without this you won't upload files bigger than 1mb, set it to however high you want it
    # even 100m is not an issue here
    client_max_body_size 30m;

    # compression on Nginx side
    gzip  on;
    gzip_vary  on;
    gzip_buffers 16 8k;
    gzip_comp_level 6;
    gzip_http_version 1.1;
    gzip_min_length 1000;
    gzip_disable     "MSIE [1-6]\.";
    gzip_proxied expired no-cache no-store private auth;
    gzip_types text/plain text/css application/x-javascript text/xml application/xml application/xml+rss text/javascript application/json application/javascript;

    include /etc/nginx/sites-available/*;
}</pre>
</div>
</div>
<div class="section" id="adding-a-domain">
<h2>Adding a domain<a class="headerlink" href="#adding-a-domain" title="Permalink to this headline">¶</a></h2>
<p>As you see in the last lines of <tt class="docutils literal"><span class="pre">nginx.conf</span></tt>, we’ve set a folder
called <tt class="docutils literal"><span class="pre">/etc/nginx/sites-available/</span></tt>. If it doesn’t exist yet, let’s
create it.</p>
<div class="highlight-python"><pre>$ cd /etc/nginx
$ mkdir sites-available
$ cd sites-available/</pre>
</div>
<p>If the directory already existed and there’s some <tt class="docutils literal"><span class="pre">default</span></tt> file that
you didn’t touch or any file, get rid of it:</p>
<div class="highlight-python"><pre>$ cd /etc/nginx/sites-available/
$ rm default</pre>
</div>
<p>Now, let’s make a new file for a domain. It will be automatically loaded
by nginx.conf. I’ll use <tt class="docutils literal"><span class="pre">foolz.us</span></tt> as example.</p>
<div class="highlight-python"><pre>$ cd /etc/nginx/sites-available/
$ nano foolz.us</pre>
</div>
<p>A first example of the file. Again, we’re going all out, so it might not
be simple to read. Please, check all the comments to adapt to your
installation.</p>
<div class="highlight-python"><pre>server {
        server_name archive.foolz.us # change this to your domain or subdomain
        index index.php;
        root /var/www/foolfuuka; # change it to the location of your FoOlFuuka

        # tell the browser to cache all static files
        # FoOlFuuka automatically deals with forcing redownload through query parameters like style.css?v=0.8.0
        location ~* \.(css|js|htc|asf|asx|wax|wmv|wmx|avi|bmp|class|divx|doc|docx|eot|exe|gif|gz|gzip|ico|jpg|jpeg|jpe|mdb|mid|midi|mov|qt|mp3|m4a|mp4|m4v|mpeg|mpg|mpe|mpp|otf|odb|odc|odf|odg|odp|ods|odt|ogg|pdf|png|pot|pps|ppt|pptx|ra|ram|svg|svgz|swf|tar|tif|tiff|ttf|ttc|wav|wma|wri|xla|xls|xlsx|xlt|xlw|zip)$ {
                expires 31536000s;
                add_header Pragma "public";
                add_header Cache-Control "public, must-revalidate, proxy-revalidate";
                try_files $uri $uri/ /index.php;
        }

        # most important part, this sends the requests to FoOlFuuka
        location / {
                try_files $uri $uri/ /index.php;
        }

        # connection to PHP
        location ~ .php$ {
                include /etc/nginx/fastcgi_params;
                fastcgi_index index.php;
                if (-f $request_filename) {
                        fastcgi_pass 127.0.0.1:9000;

                        # you can use the sockets (10%~ faster connection) if you setup PHP with a socket file
                        # fastcgi_pass unix:/dev/shm/php5-fpm.sock;
                }
        }
}

# optional
# block all sub-domains not set above
server {
        listen 80;
        server_name *.foolz.us;

        location / {
                return 403;
        }
}</pre>
</div>
<p>And with this you have FoOlFuuka running from <tt class="docutils literal"><span class="pre">http://archive.foolz.us</span></tt>. Let&#8217;s say instead that you want FoOlFuuka in a subfolder, like <tt class="docutils literal"><span class="pre">http://foolz.us/foolfuuka</span></tt>. Here&#8217;s how to go with it:</p>
<div class="highlight-python"><pre>server {
        server_name foolz.us # change this to a domain or subdomain
        index index.php;
        root /var/www/; # the root domain of your

        # tell the browser to cache all static files
        # FoOlFuuka automatically deals with forcing redownload through query parameters like style.css?v=0.8.0
        location ~* \.(css|js|htc|asf|asx|wax|wmv|wmx|avi|bmp|class|divx|doc|docx|eot|exe|gif|gz|gzip|ico|jpg|jpeg|jpe|mdb|mid|midi|mov|qt|mp3|m4a|mp4|m4v|mpeg|mpg|mpe|mpp|otf|odb|odc|odf|odg|odp|ods|odt|ogg|pdf|png|pot|pps|ppt|pptx|ra|ram|svg|svgz|swf|tar|tif|tiff|ttf|ttc|wav|wma|wri|xla|xls|xlsx|xlt|xlw|zip)$ {
                expires 31536000s;
                add_header Pragma "public";
                add_header Cache-Control "public, must-revalidate, proxy-revalidate";
                try_files $uri $uri/ /index.php;
        }

        # allow reaching the base folder, without any special magic
        # if you have index.php in the root folder it will be shown when http://foolz.us is reached
        location / {}

        # in case you have a Wordpress blog in /blog
        location /blog {
                try_files $uri $uri/ /blog/index.php;
        }

        # most important part, this sends the requests to FoOlFuuka
        # in this case we add a folder to location and try_files
        location /foolfuuka {
                try_files $uri $uri/ /foolfuuka/index.php;
        }

        # connection to PHP
        location ~ .php$ {
                include /etc/nginx/fastcgi_params;
                fastcgi_index index.php;
                if (-f $request_filename) {
                        fastcgi_pass 127.0.0.1:9000;

                        # you can use the sockets (10%~ faster connection) if you setup PHP with a socket file
                        # fastcgi_pass unix:/dev/shm/php5-fpm.sock;
                }
        }
}</pre>
</div>
<p>Once you&#8217;re done, restart Nginx:</p>
<div class="highlight-python"><pre>$ /etc/init.d/nginx restart</pre>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Configuring Nginx</a><ul>
<li><a class="reference internal" href="#nginx-conf">nginx.conf</a></li>
<li><a class="reference internal" href="#adding-a-domain">Adding a domain</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="installing_nginx.html"
                        title="previous chapter">Installing Nginx</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="installing_java.html"
                        title="next chapter">Installing Java Virtual Machine</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/server_install/configuring_nginx.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="installing_java.html" title="Installing Java Virtual Machine"
             >next</a> |</li>
        <li class="right" >
          <a href="installing_nginx.html" title="Installing Nginx"
             >previous</a> |</li>
        <li><a href="../index.html">FoOlFuuka 0.8.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, FoOlRulez.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>